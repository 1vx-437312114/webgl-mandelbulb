<!DOCTYPE html><html lang="en"><head><title>webgl raymarching - shader</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"><style type="text/css">body{color: #ffffff;font-family:Monospace;font-size:13px;text-align:center;font-weight: bold;background-color: #000000;margin: 0px;overflow: hidden;}canvas{display: block;position: absolute;top: 0;left: 0;right: 0;bottom: 0;margin: auto;}#info{position: absolute;top: 10px; width: 100%;padding: 5px;}a{color: #ffffff;}#oldie a{color:#da0}</style></head><body><div id="container"></div><div id="info"> raymarching demo (mandelbulb) - 1vx_37312114</div><script src="dat.gui.min.js"></script><script src="three.min.js"></script><script src="detector.min.js"></script><script src="stats.min.js"></script><script id="vertexShader" type="x-shader/x-vertex"> void main(){gl_Position=vec4( position, 1.0 );}</script><script id="fragmentShader" type="x-shader/x-fragment"> precision highp float; uniform vec3 iResolution; uniform float iGlobalTime; uniform bool antialiasing; float c; vec3 n(vec3 v){vec3 f=vec3(0.,-1.,0.),s=vec3(1.6,1.8,2.2); float c=max(dot(v,f),0.),y=pow(1.-max(v.y,0.),6.); vec3 i=mix(vec3(.1,.2,.3),vec3(.32,.32,.32),y); i+=s*c*c*.25+s*min(pow(c,800.)*1.5,.3); return clamp(i,vec3(0.,0.,0.),vec3(1.,1.,1.));}float s(vec3 v){const int f=14; vec3 i=v; float s=0.,y=0.; c=1.; for(int r=0;r<f;r++){s=length(i);if(s>2.){y=.5*log(s)*s/c;break;}float n=acos(i.z/s),m=atan(i.y,i.x),p=i.x*i.x+i.y*i.y+i.z*i.z,a=p*p,x=a*a,g=m*8.,d=n*8.,l=sin(d),k=sin(g),z=cos(d),t=cos(g);i.x=x*l*t;i.y=x*l*k;i.z=x*z;i+=v;float b=s*s,o=b*b;c*=o*b*s*8.+1.;}return y;}float n(in vec3 v,in vec3 f){const int i=256;const float y=100.,x=.0003;float c=0.;for(int r=0;r<i;r++){vec3 g=v+f*c;float n=s(g); if(c>y||n<x)break;c+=n;}if(c<y)return c;else return-1.;}float s(vec3 v,vec3 c){vec3 n=v+.001*c,i=n,x=c; const float f=2.;float r=1.,y=0.;for(int g=0;g<100;g++){float p=s(i+x*y);if(p<.0001)return 0.;if(y>100.) break;r=min(r,f*p/y);y+=p;}return r;}vec3 t(vec3 v){const float i=.001; vec3 f=vec3(i,0.,0.),y=vec3(0.,i,0.),x=vec3(0.,0.,i);float c=s(v+f)-s(v-f),r=s(v+y)-s(v-y),g=s(v+x)-s(v-x); vec3 n=normalize(vec3(c,r,g));return n;}float t(vec3 v,vec3 f){const float c=5.,i=.005;float r=0.; for(float y=0.;y<10.;y+=1.){float n=1./pow(2.,y);vec3 g=v+f*y*i;r+=n*(y*i-s(g));}return 1.-c*r;}vec3 p(vec2 i){const vec3 g=vec3(0.,.1,0.),y=vec3(.577,.577,-.577),r=vec3(-.707,0.,.707);const float x=1.2; float p=iResolution.x/iResolution.y;vec2 m=-1.+2.*i.xy/iResolution.xy,d=m*vec2(p,1.); float l=iGlobalTime*.15,a=1.3+.1*cos(.29*l);vec3 b=vec3(a*cos(.33*l),.8*a*sin(.37*l),a*sin(.31*l)); float z=.5*cos(.1*l);vec3 o=vec3(sin(z),cos(z),0.),k=normalize(g-b),e=normalize(cross(k,o)), u=normalize(cross(e,k)),F=normalize(d.x*u+d.y*e+x*k),C,w;float q=n(b,F);if(q<0.)C=n(F);else{vec3 h=b+q*F,Z=t(h),Y=normalize(y-F),X=reflect(F,Z);float W=.1*log(c); w=vec3(W,W,0)*abs(h);C=vec3(.7,.2,.2);C=mix(C,vec3(1.,.5,.2),sqrt(w.y));C=mix(C,vec3(1.,1.,1.),w.x); float V=clamp(dot(y,Z),0.,1.),U=clamp(.5+.5*dot(r,Z),0.,1.),T=.05*t(h,Z),S=s(h,y), R=.04+.96*pow(clamp(1.-dot(-F,Z),0.,1.),5.),Q=pow(clamp(dot(Z,Y),0.,1.),12.)*V*R*8.;vec3 P=1.5*vec3(.15,.2,.23)*(.7+.3*Z.y)*(.2+.8*T); P+=3.5*vec3(1.,.9,.6)*V*S;P+=4.1*vec3(.14,.14,.14)*U*T;P+=2.*vec3(1.,1.,1.)*Q*S*T; P+=2.*vec3(.2,.3,.4)*(.02+.98*T);P+=2.*vec3(.8,.9,1.)*smoothstep(0.,1.,X.y)*T;C*=P;C+=Q*T*S;}C=sqrt(C);return C;}void main(){vec3 v;if(antialiasing)v=p(gl_FragCoord.xy);else v=(p(gl_FragCoord.xy+vec2(-.125,-.375))+p(gl_FragCoord.xy+vec2(.375,-.125))+p(gl_FragCoord.xy+vec2(.125,.375))+p(gl_FragCoord.xy+vec2(-.375,.125)))/4.;gl_FragColor=vec4(v,1.);}</script><script>function init(){container=document.getElementById("container"),camera=new THREE.Camera,camera.position.z=1,scene=new THREE.Scene;var a=new THREE.PlaneBufferGeometry(2,2);uniforms={iGlobalTime:{value:0},iResolution:{value:new THREE.Vector3},antialiasing:{value:1}};var b=new THREE.ShaderMaterial({uniforms:uniforms,vertexShader:document.getElementById("vertexShader").textContent,fragmentShader:document.getElementById("fragmentShader").textContent}),c=new THREE.Mesh(a,b);scene.add(c),renderer=new THREE.WebGLRenderer,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(512,512),canvas=renderer.domElement,window.addEventListener("resize",onWindowResize),document.body.appendChild(canvas);var d=new dat.GUI;d.add(config,"antialiasing").name("antialiasing"),d.add(config,"resolution",["256","512","800","fullscreen"]).name("Resolution").onChange(function(a){"full"!==a&&(canvas.width=a,canvas.height=a),onWindowResize()}),stats=new Stats,container.appendChild(stats.dom),stats=new Stats,container.appendChild(stats.dom),onWindowResize(),window.addEventListener("resize",onWindowResize,!1)}function onWindowResize(a){"fullscreen"===config.resolution&&(canvas.width=window.innerWidth,canvas.height=window.innerHeight),renderer.setSize(canvas.width,canvas.height),uniforms.iResolution.value.x=renderer.domElement.width,uniforms.iResolution.value.y=renderer.domElement.height,uniforms.iResolution.value.z=0}function render(){requestAnimationFrame(render),1==config.antialiasing?uniforms.antialiasing.value=0:uniforms.antialiasing.value=1,uniforms.iGlobalTime.value+=.1,renderer.render(scene,camera),stats.update()}Detector.webgl||Detector.addGetWebGLMessage();var container,stats,camera,scene,renderer,uniforms,canvas,config={antialiasing:!1,resolution:"512"};init(),render();</script></body></html>
